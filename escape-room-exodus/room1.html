<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×—×“×¨ 1 â€” ××›×•×ª ××¦×¨×™×</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .plague-grid {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 15px 0;
    }
    .plague-card {
      background: rgba(100,0,0,0.15); border: 2px solid rgba(255,50,50,0.2);
      border-radius: 12px; padding: 14px 8px; cursor: pointer; text-align: center;
      transition: all 0.3s; min-height: 90px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .plague-card:hover:not(.done) {
      background: rgba(150,0,0,0.25); border-color: rgba(255,100,100,0.4);
      transform: translateY(-3px);
    }
    .plague-icon { font-size: 1.6rem; margin-bottom: 4px; }
    .plague-name { font-size: 0.75rem; color: rgba(255,200,200,0.7); }
    .plague-card.done {
      pointer-events: none;
    }
    .plague-card.correct-pick {
      border-color: rgba(0,255,100,0.5) !important;
      background: rgba(0,100,0,0.2) !important;
      box-shadow: 0 0 15px rgba(0,255,100,0.15);
    }
    .plague-card.wrong-pick {
      border-color: rgba(255,50,50,0.6) !important;
      background: rgba(150,0,0,0.3) !important;
      animation: stallExplode 0.6s ease-out;
    }
    @keyframes stallExplode {
      0% { transform: scale(1); }
      20% { transform: scale(1.1); box-shadow: 0 0 30px rgba(255,0,0,0.5); }
      40% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    .plague-counter {
      text-align: center; font-family: 'Secular One', sans-serif;
      font-size: 0.9rem; color: rgba(255,100,100,0.6); margin: 10px 0;
    }
    .scroll-reveal {
      display: none; margin: 15px 0; padding: 18px;
      background: rgba(80,30,0,0.3); border: 1px solid rgba(255,150,50,0.3);
      border-radius: 12px; text-align: center; animation: scrollReveal 0.8s ease-out;
    }
    .scroll-reveal.visible { display: block; }
    @keyframes scrollReveal {
      from { opacity:0; transform: scaleY(0.3); }
      to { opacity:1; transform: scaleY(1); }
    }
    @keyframes screenShake {
      0%, 100% { transform: translateX(0); }
      10% { transform: translateX(-8px); }
      20% { transform: translateX(8px); }
      30% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      50% { transform: translateX(-4px); }
      60% { transform: translateX(4px); }
      70% { transform: translateX(-2px); }
      80% { transform: translateX(2px); }
    }
    .screen-shake {
      animation: screenShake 0.6s ease-out;
    }
    @media (max-width: 600px) {
      .plague-grid { grid-template-columns: repeat(5, 1fr); gap: 4px; }
      .plague-card { padding: 10px 4px; min-height: 70px; }
      .plague-icon { font-size: 1.2rem; }
      .plague-name { font-size: 0.6rem; }
    }
  </style>
</head>
<body class="theme-plague">

  <!-- Video Background -->
  <video
    class="video-bg"
    autoplay
    muted
    loop
    playsinline
    poster="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920&q=80"
  >
    <source src="https://cdn.coverr.co/videos/coverr-red-ink-in-water-1549/1080p.mp4" type="video/mp4" />
  </video>
  <div class="fog-overlay"></div>
  <div class="dark-overlay"></div>

  <!-- Particle Canvas -->
  <canvas id="particles-canvas"></canvas>

  <!-- Timer Bar -->
  <div class="timer-bar">
    <span class="room-indicator">ğŸ©¸ ×—×“×¨ 1 â€” ××›×•×ª ××¦×¨×™×</span>
    <span class="timer-display" id="timer-display">00:00</span>
  </div>

  <!-- Main Container -->
  <div class="room-container">

    <div class="room-icon">ğŸ©¸</div>
    <h1 class="room-title">××›×•×ª ××¦×¨×™×</h1>
    <p class="room-subtitle">×¢×©×¨ ××›×•×ª. ×¡×“×¨ ××—×“. ×¨×§ ××™ ×©×–×•×›×¨ â€” ×™×¦× ×××¦×¨×™×.</p>

    <!-- Question -->
    <div class="question-box">
      <p class="question-text">×›××” ×©× ×” ×™×©×‘×• ×‘× ×™ ×™×©×¨××œ ×‘××¦×¨×™×?</p>
      <p style="font-size: 0.85rem; color: rgba(255,150,150,0.6); margin-top: 8px;">
        ğŸ©¸ ×¡×“×¨ ××ª ×¢×©×¨ ×”××›×•×ª ×‘×¡×“×¨ ×”× ×›×•×Ÿ ××”×ª×•×¨×”. ×›×œ ××›×” ×ª×—×©×•×£ ××™×œ×” ××”×¤×¡×•×§.
      </p>
    </div>

    <!-- Plague ordering instruction -->
    <p style="font-size:0.9rem; color:rgba(255,100,100,0.6); text-align:center; margin:10px 0;">
      ×œ×—×¥ ×¢×œ ×”××›×•×ª ×œ×¤×™ ×”×¡×“×¨: ×¨××©×•× ×”, ×©× ×™×™×”, ×©×œ×™×©×™×ª...
    </p>

    <!-- Plague grid â€” shuffled by JS -->
    <div class="plague-grid" id="plague-grid">
      <!-- Cards inserted by JS in random order -->
    </div>

    <!-- Counter -->
    <div class="plague-counter">
      ×¡×•×“×¨×• <span id="plague-count">0</span> ××ª×•×š 10 ××›×•×ª
    </div>

    <!-- Verse assembly bar -->
    <div style="text-align:center; margin:10px 0; padding:12px; background:rgba(255,50,50,0.05); border:1px solid rgba(255,50,50,0.15); border-radius:10px; min-height:40px;">
      <span id="verse-assembly" style="font-family:'Frank Ruhl Libre',serif; font-size:1rem; color:rgba(255,255,255,0.5); direction:rtl;"></span>
    </div>

    <!-- Scroll reveal (after all 10 correct) -->
    <div class="scroll-reveal" id="verse-scroll">
      <p style="color: #ff8844; font-size: 1rem; margin-bottom: 8px;">ğŸ“œ ×”××’×™×œ×” × ×¤×ª×—×”!</p>
      <p style="color: rgba(255,255,255,0.8); line-height: 1.8; font-size: 1rem;">
        "×•××•×©×‘ ×‘× ×™ ×™×©×¨××œ ××©×¨ ×™×©×‘×• ×‘××¦×¨×™× â€”<br>
        <strong style="color: #ffd700; font-size: 1.3rem;">×©×œ×•×©×™× ×©× ×” ×•××¨×‘×¢ ×××•×ª</strong> ×©× ×”"
      </p>
      <p style="font-size: 0.8rem; color: rgba(255,215,0,0.5); margin-top: 8px;">×©××•×ª ×™"×‘:×' â€” ×›××” ×–×” ×‘×¡×¤×¨×•×ª?</p>
    </div>

    <!-- Sefaria link -->
    <a href="https://www.sefaria.org/Exodus.12.40?lang=he" target="_blank" class="sefaria-link" style="margin:5px auto; display:inline-flex;">
      ğŸ“– ×§×¨× ××ª ×”×¤×¡×•×§ ×‘×¡×¤×¨×™×
    </a>

    <div class="password-section">
      <div class="password-wrapper">
        <input type="text" class="password-input" placeholder="×”××¡×¤×¨ ××”×¤×¡×•×§..." autocomplete="off">
        <button class="submit-btn">ğŸ”“ ×¤×ª×—</button>
      </div>
      <div class="attempts-display"></div>
      <div class="hint-box">ğŸ’¡ ×¡×“×¨ ××ª ×”××›×•×ª ×œ×¤×™ ×”×¡×“×¨. ×›×œ ××›×” ×—×•×©×¤×ª ××™×œ×” ××”×¤×¡×•×§.</div>
      <div class="hint-box strong">ğŸ”¥ ×©×œ×•×©×™× + ××¨×‘×¢ ×××•×ª = ? ×¨×©×•× ×‘×¡×¤×¨×•×ª.</div>
    </div>
  </div>

  <div class="red-flash"></div>
  <div class="success-overlay">
    <div class="success-message">ğŸ©¸ ×”××›×•×ª ×¤×¡×§×•!</div>
    <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px; font-size: 1.1rem;">×¤×¨×¢×” × ×›× ×¢. ××‘×œ ×”×“×¨×š ××¨×•×›×” â€” ×”×™× ××—×›×”.</p>
    <a href="room2.html" class="next-room-btn">â†’ ××œ ×™× ×¡×•×£ ğŸŒŠ</a>
  </div>

  <!-- Scripts -->
  <script src="particles.js"></script>
  <script src="game.js"></script>
  <script>
    if (!checkRoomAccess(1)) throw 'Access denied';
    new ParticleEngine('particles-canvas', 'fire');
    const timer = new GameTimer();
    const checker = new PasswordChecker('room1', 'room2.html');

    const plagues = [
      { name: '×“×', icon: 'ğŸ©¸', word: '×•××•×©×‘' },
      { name: '×¦×¤×¨×“×¢', icon: 'ğŸ¸', word: '×‘× ×™' },
      { name: '×›×™× ×™×', icon: 'ğŸ¦Ÿ', word: '×™×©×¨××œ' },
      { name: '×¢×¨×•×‘', icon: 'ğŸª°', word: '××©×¨' },
      { name: '×“×‘×¨', icon: 'ğŸ„', word: '×™×©×‘×•' },
      { name: '×©×—×™×Ÿ', icon: 'ğŸ”´', word: '×‘××¦×¨×™×' },
      { name: '×‘×¨×“', icon: 'ğŸŒ¨ï¸', word: '×©×œ×•×©×™×' },
      { name: '××¨×‘×”', icon: 'ğŸ¦—', word: '×©× ×”' },
      { name: '×—×•×©×š', icon: 'ğŸŒ‘', word: '×•××¨×‘×¢ ×××•×ª' },
      { name: '××›×ª ×‘×›×•×¨×•×ª', icon: 'ğŸ’€', word: '×©× ×”' }
    ];

    let nextCorrect = 0;
    const verseWords = [];

    // Shuffle and render
    const shuffled = [...plagues].map((p, i) => ({...p, correctIndex: i}));
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }

    const grid = document.getElementById('plague-grid');
    shuffled.forEach(plague => {
      const card = document.createElement('div');
      card.className = 'plague-card';
      card.innerHTML = `
        <div class="plague-icon">${plague.icon}</div>
        <div class="plague-name">${plague.name}</div>
      `;
      card.addEventListener('click', () => pickPlague(card, plague));
      grid.appendChild(card);
    });

    function pickPlague(card, plague) {
      if (card.classList.contains('done')) return;

      if (plague.correctIndex === nextCorrect) {
        // Correct order!
        card.classList.add('done', 'correct-pick');
        card.innerHTML += `<div style="font-size:0.7rem; color:#00ff88; margin-top:4px;">××›×” ${nextCorrect + 1}</div>`;

        verseWords.push(plague.word);
        document.getElementById('verse-assembly').textContent = verseWords.join(' ');
        nextCorrect++;
        document.getElementById('plague-count').textContent = nextCorrect;

        if (nextCorrect === 10) {
          setTimeout(() => {
            document.getElementById('verse-scroll').classList.add('visible');
            document.querySelector('.password-input').focus();
          }, 800);
        }
      } else {
        // Wrong order!
        card.classList.add('wrong-pick');
        document.body.classList.add('screen-shake');
        const flash = document.querySelector('.red-flash');
        flash.classList.remove('active'); void flash.offsetWidth; flash.classList.add('active');

        setTimeout(() => {
          card.classList.remove('wrong-pick');
          document.body.classList.remove('screen-shake');
        }, 600);

        // Track error
        const errors = parseInt(localStorage.getItem(GAME.STORAGE_PREFIX + 'Errors') || '0') + 1;
        localStorage.setItem(GAME.STORAGE_PREFIX + 'Errors', errors.toString());
      }
    }
  </script>

</body>
</html>
